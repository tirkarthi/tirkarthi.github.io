<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Delicious maps and filters</title>
  <meta name="description" content="The post assumes some experience with Python but most of the code looks like pseudocode only. The corresponding clojure code is also presented and can be eva...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://tirkarthi.github.io/clojure/2016/06/28/delicious-maps-and-filters.html">
  <link rel="alternate" type="application/rss+xml" title="xtreak blog" href="http://tirkarthi.github.io/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">xtreak blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Delicious maps and filters</h1>
    <p class="post-meta"><time datetime="2016-06-28T20:14:29+05:30" itemprop="datePublished">Jun 28, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>The post assumes some experience with Python but most of the code looks like pseudocode only. The corresponding clojure code is also presented and can be evaluated live by changing the code. First let me explain some basic clojure code and its fairly easy to pick up</p>

<figure class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="c1">;; let city be "paris". Its associating a name with a value.
</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="s">"paris"</span><span class="p">)</span><span class="w">

</span><span class="c1">;; A vector of numbers with fast access by index. Like arrays but implemeted differently under the hood
</span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w">

</span><span class="c1">;; A list of numbers similar to a linked list
</span><span class="o">'</span><span class="p">(</span><span class="nf">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">

</span><span class="c1">;; A dictionary or hash like {name: "kate", city: "paris"}
</span><span class="p">{</span><span class="s">"name"</span><span class="w"> </span><span class="s">"kate"</span><span class="n">,</span><span class="w"> </span><span class="s">"city"</span><span class="w"> </span><span class="s">"paris"</span><span class="p">}</span><span class="w">

</span><span class="c1">;; a set of strings and hence it cannot contain duplicates
</span><span class="o">#</span><span class="p">{</span><span class="s">"kate"</span><span class="w"> </span><span class="s">"kim"</span><span class="w"> </span><span class="s">"john"</span><span class="p">}</span><span class="w">

</span><span class="c1">;; define a new function called say-hello that takes an argument of name and prints a "Hello ," name
</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">say-hello</span><span class="w"> </span><span class="p">[</span><span class="nb">name</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"Hello ,"</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w">

</span><span class="c1">;; Most clojure code is of the form (function-name arguments)
;; Here you call say-hello with the argument "kate"
</span><span class="p">(</span><span class="nf">say-hello</span><span class="w"> </span><span class="s">"kate"</span><span class="p">)</span><span class="w">

</span><span class="c1">;; Clojure follows prefix notation so its actually applying + function with the arguments 3 4 5
</span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="c1">;; returns 12
</span><span class="w">
</span><span class="c1">;; Clojure follows prefix notation so its actually applying * function with the arguments 3 4 5
</span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="c1">;; returns 60
</span><span class="w">
</span><span class="c1">;; Define a function that returns square of the given number
</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="p">[</span><span class="n">number</span><span class="p">]</span><span class="w">
      </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">number</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="nf">square</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="err">;;</span><span class="w"> </span><span class="n">gives</span><span class="w"> </span><span class="mi">25</span></code></pre></figure>

<p>For sake of this post lets pick up a problem where and solve it with both Python and Clojure.</p>

<h1 id="simple-problem">Simple problem</h1>

<p>List down all the numbers from 1 to 30 whose square is an odd number</p>

<p>So lets take it step by step</p>

<ul>
  <li>We generate a list of all numbers less than 10</li>
  <li>Calculate the square of each number</li>
  <li>Check if the square is an odd number and if so add it to the list</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">odd_squares</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">*</span> <span class="n">number</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">odd_squares</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">number</span> <span class="o">*</span> <span class="n">number</span><span class="p">)</span></code></pre></figure>

<p>Here we are directly squaring things up and checking if the number is an odd one. Suddenly if want to change
it so that all the odd cubes are listed then we have to go around and add the code to cube and along with that
we also need to see the part where the odd number is checked which adds up some cognitive load when and as more
logic is added we get a sense of dizziness as we touch the function as we need to look at the whole code. So we
refactor them and name them properly and we will see that the code becomes more clear.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">odd_squares</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">*</span> <span class="n">number</span>

<span class="k">def</span> <span class="nf">is_odd</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
    <span class="n">squared</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_odd</span><span class="p">(</span><span class="n">squared</span><span class="p">):</span>
        <span class="n">odd_squares</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">square</span><span class="p">)</span></code></pre></figure>

<h1 id="maps-and-filters">Maps and filters</h1>

<p>Map and filter are basic functional programming constructs that are available under different names in different languages.
Map is a function that takes a function and a list and applies the function every member of the list and returns the results
as a list. Filter does the same thing except that it returns the members that return true for the function. So lets rewrite
our programs with maps and functions. They seem like loops but the important distinction is that they functions as parameters.
Hence these functions that take other functions as parameters and operate on them are higher-order functions. lambda is used
to construct anonymous functions in Python that is functions that don’t have a name and are of short term use.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># similar to the clojure code with anonymous functions</span>
<span class="n">square</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">number</span><span class="p">:</span> <span class="n">number</span> <span class="o">*</span> <span class="n">number</span>

<span class="n">square</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c"># returns 25</span>

<span class="n">odd_squares</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)))</span></code></pre></figure>

<p>Whoa! that seems like lot of few code and rewriting them with named functions makes them much more elegant. We come to
see that it pretty much reads like english. map resmebles to mathematical term where we map the list on a function in our
classic set theory classes. These abstractions help us in transforming the code from telling the computer to do things to
saying the properties and letting the computer figure out the looping constructs for us.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">*</span> <span class="n">number</span>

<span class="k">def</span> <span class="nf">is_odd</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span>

<span class="n">odd_squares</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">is_odd</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)))</span></code></pre></figure>

<p>Well we wrote some elegant Python but where does Clojure fit in this thing. We will see that these constructs are taken from Lisp
and Clojure offers us much more flexibility in writing better code for the given problem with more abstractions. We will take it from here
by writing code with map and filter and see how we can make it more elegant with macros.</p>

<figure class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="p">[</span><span class="n">number</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">number</span><span class="p">))</span><span class="w">

</span><span class="c1">;; Clojure has inbuilt odd? function to check if its odd
;; Clojure allows question marks and hypens in names
</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">odd-squares</span><span class="w"> </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="n">odd?</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="p">(</span><span class="nb">range</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">31</span><span class="p">))))</span></code></pre></figure>

<p>Well that pretty much reads like Python except with more parens that are slightly annoying visually and also as you can see our code scales horizontally with the number of constructs added to it. Thats a bad thing since code mostly involves filtering and mapping contiuously throughout the loops and writing 4-5 such constructs make it more tedious to read and adds up much more mental cognition.
Also the code reads from right to left which also adds some load as we have to hop back and forth between the parens with to keep track
of the whole thing</p>

<h1 id="macros-to-the-rescue">Macros to the rescue!</h1>

<p><em>“Lisp is a programmable programming language.” - John Foderaro, CACM, September 1991</em></p>

<p>Macros add more syntactic abstraction and takes it down to the next dimension. Since the whole thing is a pipeline won’t it be nice to have a pipeline type of operator where we can define our own constructs not functions our own syntactic constructs and operators. Lets see
how that boils down to things.</p>

<figure class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="p">[</span><span class="n">number</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">number</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="nf">-&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">range</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span><span class="w">
     </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">square</span><span class="p">)</span><span class="w">
     </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="n">odd?</span><span class="p">))</span></code></pre></figure>

<p>This whole thing seems like black magic what is that double arrow thingy functions cannot have those symbols so are they operators on their own? This leads us to add more and more filters and transformations down the pipeline and the extra advantage is that we can just swap the functions and build a new pipeline without worrying about the whole constructs. Lets say we need to change the function to return even cubes well its more easy to do so. We can swap the map and filter functions and we have a new pipeline on our hands</p>

<figure class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="p">[</span><span class="n">number</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">number</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">cube</span><span class="w"> </span><span class="p">[</span><span class="n">number</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="p">(</span><span class="nf">square</span><span class="w"> </span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="n">number</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="nf">-&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">range</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span><span class="w">
     </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">cube</span><span class="p">)</span><span class="w">
     </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="n">even?</span><span class="p">))</span></code></pre></figure>


  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">xtreak blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>xtreak blog</li>
          <li><a href="mailto:tir.karthi@gmail.com">tir.karthi@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/tirkarthi"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">tirkarthi</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/tirkarthi"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">tirkarthi</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>A blog about programming, mistakes and eureka</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
